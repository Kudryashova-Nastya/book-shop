import React from 'react';
import Store from "../../store/Store";
import {Button, Card, Stack} from "react-bootstrap";
import {observer} from "mobx-react";
import './style.css';
import BuyButton from "./BuyButton";
import BuyBooksModal from "../Modal/BuyBooksModal";
import NoBalanceModal from "../Modal/NoBalanceModal";
import DeletePositionModal from "../Modal/DeletePositionModal";
import ClearCartModal from "../Modal/ClearCartModal";

const Item = observer(({name, price, count}) => {
    return (
        <Card border="primary" className="mb-2">
            <Stack direction="horizontal" gap={1} className='cart__stack'>
                <div>
                    <p>{name}</p>
                    <h6>{price} р</h6>
                </div>
                <div className="ms-auto cart__input">
                    <span onClick={() => {
                        Store.plus(name)
                    }}>
                        <svg width="19" height="11" viewBox="0 0 19 11" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M8.9081 0.259789L0.225798 9.59441C0.080856 9.75016 0 9.95709 0 10.1723C0 10.3875 0.080856 10.5944 0.225798 10.7501L0.235608 10.7602C0.305873 10.836 0.39045 10.8963 0.484194 10.9375C0.577939 10.9787 0.678891 11 0.780909 11C0.882927 11 0.983879 10.9787 1.07762 10.9375C1.17137 10.8963 1.25594 10.836 1.32621 10.7602L9.50163 1.96993L17.6738 10.7602C17.7441 10.836 17.8286 10.8963 17.9224 10.9375C18.0161 10.9787 18.1171 11 18.2191 11C18.3211 11 18.4221 10.9787 18.5158 10.9375C18.6095 10.8963 18.6941 10.836 18.7644 10.7602L18.7742 10.7501C18.9191 10.5944 19 10.3875 19 10.1723C19 9.95709 18.9191 9.75016 18.7742 9.59441L10.0919 0.259789C10.0155 0.177694 9.92371 0.112338 9.82197 0.0676825C9.72023 0.0230265 9.61069 0 9.5 0C9.38931 0 9.27977 0.0230265 9.17803 0.0676825C9.07628 0.112338 8.98445 0.177694 8.9081 0.259789Z"
                                fill="#888888"/>
                        </svg>
                    </span>
                    <input type="number" min='1' className="form-control" value={count}
                           onChange={(e) => {
                               Store.changeCount(name, +e.target.value)
                           }}/>
                    <span onClick={() => {
                        Store.minus(name)
                    }}>
                        <svg width="19" height="11" viewBox="0 0 19 11" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M10.0919 10.7402L18.7742 1.40559C18.9191 1.24984 19 1.04291 19 0.827729C19 0.612545 18.9191 0.405618 18.7742 0.249865L18.7644 0.239814C18.6941 0.164047 18.6095 0.103715 18.5158 0.0624879C18.4221 0.0212606 18.3211 1.35718e-07 18.2191 1.35718e-07C18.1171 1.35718e-07 18.0161 0.0212606 17.9224 0.0624879C17.8286 0.103715 17.7441 0.164047 17.6738 0.239814L9.49837 9.03007L1.32621 0.239814C1.25595 0.164047 1.17137 0.103715 1.07763 0.0624879C0.983881 0.0212606 0.882929 1.35718e-07 0.780911 1.35718e-07C0.678893 1.35718e-07 0.577941 0.0212606 0.484197 0.0624879C0.390453 0.103715 0.305875 0.164047 0.23561 0.239814L0.225799 0.249865C0.0808574 0.405618 6.00006e-07 0.612545 6.00006e-07 0.827729C6.00006e-07 1.04291 0.0808574 1.24984 0.225799 1.40559L8.9081 10.7402C8.98445 10.8223 9.07629 10.8877 9.17803 10.9323C9.27977 10.977 9.38931 11 9.5 11C9.61069 11 9.72023 10.977 9.82197 10.9323C9.92372 10.8877 10.0155 10.8223 10.0919 10.7402Z"
                                fill="#888888"/>
                        </svg>
                    </span>
                </div>
                <div>
                    <Button title="удалить из корзины" variant="secondary" size="sm" onClick={() => {
                        Store.setDeletePositionVisible(name)
                    }}>
                        <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M4.93909 3.99943L7.80299 1.14179C7.92841 1.01635 7.99886 0.846231 7.99886 0.668843C7.99886 0.491455 7.92841 0.321332 7.80299 0.1959C7.67758 0.0704673 7.50748 0 7.33012 0C7.15275 0 6.98265 0.0704673 6.85724 0.1959L4 3.06021L1.14276 0.1959C1.01735 0.0704673 0.847248 -1.32164e-09 0.669885 0C0.492522 1.32165e-09 0.322423 0.0704673 0.197008 0.1959C0.0715939 0.321332 0.00113664 0.491455 0.00113664 0.668843C0.00113663 0.846231 0.0715939 1.01635 0.197008 1.14179L3.06091 3.99943L0.197008 6.85708C0.134583 6.919 0.085035 6.99267 0.0512219 7.07385C0.0174088 7.15502 0 7.24208 0 7.33002C0 7.41796 0.0174088 7.50502 0.0512219 7.58619C0.085035 7.66737 0.134583 7.74104 0.197008 7.80296C0.258924 7.8654 0.332587 7.91495 0.413748 7.94877C0.494909 7.98259 0.581962 8 0.669885 8C0.757808 8 0.844861 7.98259 0.926022 7.94877C1.00718 7.91495 1.08085 7.8654 1.14276 7.80296L4 4.93866L6.85724 7.80296C6.91915 7.8654 6.99282 7.91495 7.07398 7.94877C7.15514 7.98259 7.24219 8 7.33012 8C7.41804 8 7.50509 7.98259 7.58625 7.94877C7.66741 7.91495 7.74108 7.8654 7.80299 7.80296C7.86542 7.74104 7.91497 7.66737 7.94878 7.58619C7.98259 7.50502 8 7.41796 8 7.33002C8 7.24208 7.98259 7.15502 7.94878 7.07385C7.91497 6.99267 7.86542 6.919 7.80299 6.85708L4.93909 3.99943Z"
                                fill="white"/>
                        </svg>
                    </Button>
                </div>
            </Stack>
        </Card>
    )
})

const CartList = observer(() => {
    return (
        <>
            <div className='cart__list'>
                {Store.cart?.map(item => (
                    <Item key={item.name} name={item.name} price={item.price} count={item.count}/>
                ))}
            </div>
            <BuyButton/>
        </>
    )
})

const Cart = observer(() => {
    return (
        <>
            <div className='cart__head'>
                <h3>Корзина</h3>
                {Store.cart.length !== 0 ?
                <Button variant="outline-secondary" title="Очистить корзину" size="sm" onClick={Store.setClearCartVisible}>
                    <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.3395 21.7222H5.66056C5.41471 21.7164 5.17242 21.6622 4.94752 21.5628C4.72262 21.4633 4.51952 21.3205 4.34984 21.1425C4.18015 20.9645 4.0472 20.7548 3.95857 20.5254C3.86995 20.296 3.8274 20.0514 3.83334 19.8056V7.17473H5.11112V19.8056C5.10502 19.8836 5.11441 19.9621 5.13876 20.0366C5.16311 20.111 5.20193 20.1799 5.25299 20.2393C5.30405 20.2986 5.36635 20.3473 5.43629 20.3825C5.50624 20.4178 5.58246 20.4388 5.66056 20.4445H17.3395C17.4176 20.4388 17.4938 20.4178 17.5637 20.3825C17.6337 20.3473 17.696 20.2986 17.747 20.2393C17.7981 20.1799 17.8369 20.111 17.8613 20.0366C17.8856 19.9621 17.895 19.8836 17.8889 19.8056V7.17473H19.1667V19.8056C19.1726 20.0514 19.1301 20.296 19.0414 20.5254C18.9528 20.7548 18.8199 20.9645 18.6502 21.1425C18.4805 21.3205 18.2774 21.4633 18.0525 21.5628C17.8276 21.6622 17.5853 21.7164 17.3395 21.7222V21.7222Z" fill="#F3969A"/>
                        <path d="M19.665 5.75001H3.19443C3.02499 5.75001 2.86248 5.6827 2.74267 5.56288C2.62285 5.44307 2.55554 5.28056 2.55554 5.11112C2.55554 4.94167 2.62285 4.77917 2.74267 4.65936C2.86248 4.53954 3.02499 4.47223 3.19443 4.47223H19.665C19.8344 4.47223 19.9969 4.53954 20.1167 4.65936C20.2366 4.77917 20.3039 4.94167 20.3039 5.11112C20.3039 5.28056 20.2366 5.44307 20.1167 5.56288C19.9969 5.6827 19.8344 5.75001 19.665 5.75001Z" fill="#F3969A"/>
                        <path d="M13.4167 8.30556H14.6944V17.8889H13.4167V8.30556Z" fill="#F3969A"/>
                        <path d="M8.30554 8.30556H9.58332V17.8889H8.30554V8.30556Z" fill="#F3969A"/>
                        <path d="M14.6944 3.74388H13.4805V2.55555H9.51943V3.74388H8.30554V2.55555C8.30513 2.22745 8.43095 1.91176 8.65693 1.67388C8.88291 1.43601 9.19174 1.29418 9.51943 1.27777H13.4805C13.8082 1.29418 14.1171 1.43601 14.343 1.67388C14.569 1.91176 14.6948 2.22745 14.6944 2.55555V3.74388Z" fill="#F3969A"/>
                    </svg>
                </Button> : null}
            </div>
            {Store.cart.length !== 0 ? <CartList/>
                : <div className='cart__empty'><p>нет добавленных книг</p></div>}

            {Store.modalBuyVisible ? <BuyBooksModal/> : null}
            {Store.modalNoBalanceVisible ? <NoBalanceModal/> : null}
            {Store.modalDeletePositionVisible ? <DeletePositionModal/> : null}
            {Store.modalClearCartVisible ? <ClearCartModal/> : null}
        </>
    )
})

export default Cart